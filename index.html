<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- SEO -->
  <title>Free Image Converter | JPG to PNG, WebP, ICO Online (No Sign-Up)</title>
  <meta name="description" content="Free, no sign-up, no uploads. Fast JPG ↔ PNG ↔ WebP ↔ ICO converter with batch support, resize, and ZIP download. 100% client-side." />
  <meta name="keywords" content="free image converter, jpg to png, png to webp, webp to jpg, ico converter, no signup, batch converter, offline" />
  <link rel="canonical" href="https://www.freeimageconverter.net/" />
  <link rel="alternate" href="https://www.freeimageconverter.net/" hreflang="x-default" />
  <meta name="theme-color" content="#0b0c10">

  <link rel="preload" as="image" href="og.png">

  <!-- OG/Twitter -->
  <meta property="og:title" content="Free Image Converter | JPG to PNG, WebP, ICO Online (No Sign-Up)" />
  <meta property="og:description" content="Free forever · No login · No uploads. Drag-and-drop, batch, resize, ZIP. Ad-supported." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.freeimageconverter.net/" />
  <meta property="og:image" content="https://www.freeimageconverter.net/og.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:locale:alternate" content="ar_SA" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Free Image Converter | JPG to PNG, WebP, ICO Online (No Sign-Up)" />
  <meta name="twitter:description" content="Free forever · No login · No uploads. Drag-and-drop, batch, resize, ZIP. 100% client-side." />
  <meta name="twitter:image" content="https://www.freeimageconverter.net/og.png" />

  <!-- JSON-LD: WebApplication -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"Free Image Converter",
    "applicationCategory":"MultimediaApplication",
    "operatingSystem":"Any",
    "url":"https://www.freeimageconverter.net/",
    "inLanguage":["en","ar"],
    "description":"Free, client-side image converter (JPG, PNG, WebP, ICO) with batch, resize, and ZIP download. No sign-up or uploads.",
    "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}
  }
  </script>

  <!-- JSON-LD: FAQPage -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "@id": "https://www.freeimageconverter.net/#faq",
    "mainEntity": [
      {"@type":"Question","name":"How to convert JPG to PNG free?","acceptedAnswer":{"@type":"Answer","text":"Drag and drop your JPG, choose PNG as output, then click Convert. No sign-up or upload required."}},
      {"@type":"Question","name":"Can I convert WebP to ICO without sign-up?","acceptedAnswer":{"@type":"Answer","text":"Yes. Select your WebP image, set output to ICO (256×256), and download instantly. Everything runs in your browser."}},
      {"@type":"Question","name":"Does this converter support large images?","acceptedAnswer":{"@type":"Answer","text":"Yes. Processing happens locally using the Canvas API. The main limit is your device memory."}},
      {"@type":"Question","name":"Is the tool free forever and without login?","acceptedAnswer":{"@type":"Answer","text":"Yes. It is 100% free and ad-supported. No account or sign-up is required."}},
      {"@type":"Question","name":"Can I batch convert multiple images and download as ZIP?","acceptedAnswer":{"@type":"Answer","text":"Yes. Add multiple files, click Convert, then download each or all together as a ZIP archive."}}
    ]
  }
  </script>

  <style>
    :root{
      --bg:#0b0c10; --bg-soft:#111318; --card:#151822; --muted:#8a93a2; --text:#e9edf5;
      --accent:#4f8cff; --accent-2:#16c79a; --danger:#ff5c7a; --border:#242836; --shadow:0 10px 30px rgba(0,0,0,.35);
      color-scheme: light dark;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f7f8fb; --bg-soft:#eef1f7; --card:#fff; --muted:#5d6576; --text:#121521; --border:#e6e9f0; --shadow:0 10px 24px rgba(14,22,36,.08) }
    }
    [data-theme="light"]{
      --bg:#f7f8fb; --bg-soft:#eef1f7; --card:#fff; --muted:#5d6576; --text:#121521; --border:#e6e9f0; --shadow:0 10px 24px rgba(14,22,36,.08)
    }
    [data-theme="dark"]{
      --bg:#0b0c10; --bg-soft:#111318; --card:#151822; --muted:#8a93a2; --text:#e9edf5; --border:#242836; --shadow:0 10px 30px rgba(0,0,0,.35)
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji"}
    a{color:var(--accent);text-decoration:none}
    header{position:sticky;top:0;z-index:10;backdrop-filter:saturate(1.2) blur(6px);background:color-mix(in oklab,var(--bg) 70%,transparent);border-bottom:1px solid var(--border)}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .hero{display:grid;grid-template-columns:1fr 320px;gap:16px;align-items:center}
    @media (max-width:980px){.hero{grid-template-columns:1fr}}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:var(--shadow)}
    .brand h1{margin:0;font-size:1.25rem}
    .badge{margin-left:8px;font-size:.85rem;color:white;background:linear-gradient(135deg,var(--accent),var(--accent-2));padding:4px 8px;border-radius:999px}
    .lang-toggle,.theme-toggle{margin-left:auto;display:flex;gap:8px;align-items:center}
    .lang-toggle button,.theme-toggle button{border:1px solid var(--border);background:var(--card);color:var(--text);padding:6px 10px;border-radius:10px;cursor:pointer}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
    .card .pad{padding:18px}
    main .grid{display:grid;grid-template-columns:1fr 320px;gap:16px}
    @media (max-width:980px){main .grid{grid-template-columns:1fr}}
    .controls{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px}
    @media (max-width:980px){.controls{grid-template-columns:1fr 1fr}}
    @media (max-width:520px){.controls{grid-template-columns:1fr}}
    label.small{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    select,input[type="color"],input[type="range"],input[type="file"],input[type="number"]{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:var(--bg-soft);color:var(--text)}
    input[type="range"]{padding:0;height:40px}
    .hint{color:var(--muted);font-size:12px}
    .buttons{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    .btn{border:1px solid var(--border);background:var(--accent);color:white;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600;box-shadow:var(--shadow)}
    .btn.secondary{background:var(--bg-soft);color:var(--text)}
    .btn.danger{background:var(--danger)}
    .drop{border:2px dashed var(--border);border-radius:14px;padding:24px;text-align:center;background:repeating-linear-gradient(45deg,color-mix(in oklab,var(--card) 95%,transparent),color-mix(in oklab,var(--card) 95%,transparent) 8px,transparent 8px,transparent 16px);transition:background .15s ease,border-color .15s ease;color:var(--muted)}
    .drop.dragover{border-color:var(--accent);background:color-mix(in oklab,var(--accent) 10%,var(--card) 90%)}
    .list{width:100%;border-collapse:collapse}
    .list th,.list td{border-bottom:1px solid var(--border);padding:10px;vertical-align:middle}
    .thumb{width:52px;height:52px;object-fit:cover;border-radius:10px;border:1px solid var(--border)}
    .ad-slot{background:var(--bg-soft);border:1px dashed var(--border);border-radius:16px;min-height:120px;display:grid;place-items:center;color:var(--muted)}
    .toast{position:fixed;bottom:18px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--card);color:var(--text);border:1px solid var(--border);padding:12px 16px;border-radius:12px;box-shadow:var(--shadow);opacity:0;pointer-events:none;transition:transform .2s ease,opacity .2s ease}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0);pointer-events:auto}
    .progress{height:10px;background:var(--bg-soft);border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .progress>span{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent-2))}
    footer{color:var(--muted);font-size:12px;padding:24px 0;text-align:center}
    .nowrap{white-space:nowrap}
    dialog{border:none;border-radius:16px;background:var(--card);color:var(--text);box-shadow:var(--shadow);max-width:720px}
    dialog::backdrop{background:rgba(0,0,0,.35)}
    .modal-actions{display:flex;justify-content:flex-end;gap:10px;margin-top:12px}
    #contactDlg input[type="email"], #contactDlg textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:var(--bg-soft);color:var(--text)}
  </style>

  <!-- JSZip & FileSaver -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script>if(typeof window.saveAs!=='function'){window.saveAs=function(b,n){const a=document.createElement('a'),u=URL.createObjectURL(b);a.href=u;a.download=n||'download';document.body.appendChild(a);a.click();a.remove();setTimeout(()=>URL.revokeObjectURL(u),1000);}};</script>

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZT3BHHBZQ3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag("js", new Date());
    gtag("config", "G-ZT3BHHBZQ3", { anonymize_ip: true, send_page_view: true });
  </script>
</head>
<body>
  <header>
    <div class="wrap hero">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1 id="appTitle">Free Image Converter</h1>
        <span class="badge" id="freeBadge">Free forever · No login</span>
        <div class="theme-toggle" role="group" aria-label="Theme">
          <button id="themeLight" aria-pressed="false" type="button" aria-label="Switch to light theme">Light</button>
          <button id="themeDark" aria-pressed="false" type="button" aria-label="Switch to dark theme">Dark</button>
          <button id="themeAuto" aria-pressed="true" type="button" aria-label="Use system theme">Auto</button>
        </div>
        <div class="lang-toggle" role="group" aria-label="Language" style="margin-left:8px">
          <button id="btnEN" aria-pressed="true" type="button" aria-label="Switch language to English">EN</button>
          <button id="btnAR" aria-pressed="false" type="button" aria-label="التبديل إلى العربية">AR</button>
        </div>
      </div>
      <aside class="ad-slot" id="adTop" aria-label="Advertisement">
        <span>Ad Slot — 728×90 / Responsive</span>
      </aside>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <section class="card">
        <div class="pad">
          <p id="lead">Free forever. No sign-up. No uploads. Convert between JPG, PNG, WebP, and ICO with drag-and-drop, batch processing, optional resize, and ZIP download. Ad-supported.</p>

          <!-- Controls -->
          <div class="controls" aria-label="Conversion options">
            <div>
              <label class="small" for="fmtSelect" id="lblFormat">Output format</label>
              <select id="fmtSelect" aria-label="Select output format">
                <option value="png">PNG</option>
                <option value="jpg" selected>JPG</option>
                <option value="webp">WebP</option>
                <option value="ico">ICO (256×256)</option>
              </select>
              <div class="hint" id="fmtHint">JPG/WebP allow quality setting. ICO is a 256×256 PNG inside an ICO header.</div>
            </div>

            <div id="qualityWrap">
              <label class="small" for="quality" id="lblQuality">Quality (JPG/WebP)</label>
              <input type="range" id="quality" min="0.1" max="1" step="0.01" value="0.92" aria-label="Quality slider" />
              <div class="hint"><span id="qualityVal">0.92</span></div>
            </div>

            <div id="bgWrap">
              <label class="small" for="bgColor" id="lblBG">Background for JPG (transparent areas)</label>
              <input type="color" id="bgColor" value="#ffffff" aria-label="Background color for JPG" />
              <div class="hint" id="bgHint">Used only when output is JPG.</div>
            </div>

            <!-- Resize Options -->
            <div id="resizeWrap">
              <label class="small" for="resizeMode" id="lblResize">Resize before convert (optional)</label>
              <select id="resizeMode" aria-label="Select resize mode">
                <option value="none" selected>No resize</option>
                <option value="percent">Scale %</option>
                <option value="maxw">Max width (px)</option>
              </select>
              <div class="hint" id="resizeHint">Reduce size for faster processing on low-memory devices.</div>
            </div>
          </div>

          <!-- Dynamic Resize Inputs -->
          <div class="controls" id="resizeInputs" style="margin-top: -6px;">
            <div id="percentWrap" style="display:none">
              <label class="small" for="percentVal" id="lblPercent">Scale percentage</label>
              <input type="number" id="percentVal" min="10" max="200" step="10" value="100" aria-label="Scale percentage value" />
              <div class="hint">100% = original size</div>
            </div>
            <div id="maxwWrap" style="display:none">
              <label class="small" for="maxWidth" id="lblMaxW">Max width (px)</label>
              <input type="number" id="maxWidth" min="128" step="32" value="1000" aria-label="Maximum width in pixels" />
              <div class="hint">Keeps aspect ratio. Height auto-scales.</div>
            </div>
            <div>
              <label class="small">&nbsp;</label>
              <div class="progress" aria-label="Progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><span id="progressBar"></span></div>
              <div class="hint" id="progressText" role="status" aria-live="polite">0%</div>
            </div>
          </div>

          <div class="buttons">
            <input type="file" id="picker" accept="image/*,.ico" multiple hidden />
            <button class="btn" id="pickBtn" type="button" aria-label="Choose files">Choose Files</button>
            <button class="btn secondary" id="clearBtn" type="button" aria-label="Clear file list">Clear List</button>
            <span class="hint" id="privacyNote">Free · No login · All processing in your browser.</span>
          </div>

          <div class="card" style="margin-top:12px">
            <div class="pad">
              <div class="drop" id="drop" aria-label="Drop area for images">
                <strong id="dropTitle">Drag & drop images</strong>
                <div id="dropHint" class="hint">JPG, PNG, WebP, ICO. Batch supported. *Large images work; device memory is the only limit.</div>
              </div>
            </div>
          </div>

          <div class="buttons" style="margin-top:12px">
            <button class="btn" id="convertBtn" type="button" aria-label="Start conversion">Convert</button>
            <button class="btn secondary" id="zipBtn" type="button" disabled aria-label="Download all files as ZIP" aria-disabled="true">Download All (ZIP)</button>
          </div>

          <!-- In-content Ad Slot -->
          <div class="ad-slot" style="margin:12px 0;" aria-label="Advertisement">
            <span>Ad Slot — In-content / Responsive</span>
          </div>

          <div class="card" style="margin-top:8px">
            <div class="pad">
              <table class="list" id="fileTable" aria-label="Files">
                <thead>
                  <tr>
                    <th scope="col">Preview</th><th scope="col">File</th><th class="nowrap" scope="col">Original</th><th class="nowrap" scope="col">Output</th><th scope="col">Status</th><th scope="col">Download</th>
                  </tr>
                </thead>
                <tbody id="fileBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <aside class="card">
        <div class="pad">
          <div class="ad-slot" style="min-height:250px" aria-label="Advertisement">
            <span>Ad Slot — 300×250 / Responsive</span>
          </div>
          <h3 style="margin-top:18px" id="faqTitle">Notes</h3>
          <ul id="faqList" style="margin-top:8px; padding-left:18px">
            <li>Free forever. No account needed.</li>
            <li>No uploads — everything runs locally via Canvas.</li>
            <li>Handles large images; your device/browser limits apply.</li>
            <li>Optional resize (Scale % or Max width) to speed processing.</li>
            <li>JPG/WebP quality slider controls compression (0.1–1.0).</li>
            <li>ICO output is a single 256×256 PNG embedded in an ICO container.</li>
            <li>Transparency becomes your chosen color for JPG.</li>
          </ul>
        </div>
      </aside>
    </div>
        <section class="card" id="blogLinks" style="margin-top:16px">
        <div class="pad">
          <h3>From the Blog</h3>
          <ul style="padding-left:18px;margin-top:8px">
            <li><a href="/blog/jpg-to-png.html">How to Convert JPG to PNG Without Losing Quality</a></li>
            <li><a href="/blog/jpg-vs-png-vs-webp.html">What is the Difference Between JPG, PNG, and WebP?</a></li>
            <li><a href="/blog/free-tools.html">Top 5 Free Tools to Convert Images Online (And Why Ours is Different)</a></li>
            <li><a href="/blog/png-to-ico.html">How to Convert Images to ICO for Favicon in Seconds</a></li>
            <li><a href="/blog/batch-conversion.html">Batch Image Conversion: Save Time by Converting Multiple Images at Once</a></li>
            <li><a href="/blog/webp-better.html">Why WebP Format is Better for Web Performance</a></li>
            <li><a href="/blog/reduce-image-size.html">How to Reduce Image Size Without Losing Quality (Resize Guide)</a></li>
            <li><a href="/blog/offline-vs-online.html">Offline Image Converter vs Online Tools: Which is Better?</a></li>
            <li><a href="/blog/transparent-jpg.html">How to Create Transparent Background JPGs</a></li>
            <li><a href="/blog/best-format-2025.html">The Complete Guide to Choosing the Right Image Format in 2025</a></li>
          </ul>
        </div>
      </section>
    
  </main>

  <div class="toast" id="toast" role="status" aria-live="polite">✅ Conversion complete</div>

  <footer class="wrap">
    <div>© <span id="year"></span> Free Image Converter — Client-Side ·
      <a href="#" data-modal="aboutDlg">About</a> ·
      <a href="#" data-modal="privacyDlg">Privacy</a> ·
      <a href="#" data-modal="termsDlg">Terms</a> ·
      <a href="#" data-modal="contactDlg">Contact</a>
     · <a href="/blog.html">Blog</a></div>
  </footer>

  <!-- Modals -->
  <dialog id="aboutDlg"><div class="pad">
    <h3>About</h3>
    <p>Free, ad-supported, client-side image converter. No sign-up, no uploads. Built for speed and privacy.</p>
    <div class="modal-actions"><button class="btn secondary" data-close type="button">Close</button></div>
  </div></dialog>

  <dialog id="privacyDlg"><div class="pad">
    <h3>Privacy Policy</h3>
    <p>All image processing happens locally in your browser via the Canvas API. We do not upload or store your files on any server. Analytics scripts may set cookies per Google policies.</p>
    <div class="modal-actions"><button class="btn secondary" data-close type="button">Close</button></div>
  </div></dialog>

  <dialog id="termsDlg"><div class="pad">
    <h3>Terms of Service</h3>
    <p>Service is provided “as-is” without warranties. You are responsible for ensuring you have rights to process and download images you convert.</p>
    <div class="modal-actions"><button class="btn secondary" data-close type="button">Close</button></div>
  </div></dialog>

  <!-- CONTACT: Formspree-only (no email exposed) -->
  <dialog id="contactDlg"><div class="pad">
    <h3>Contact</h3>
    <p class="hint" style="margin-top:-4px">Send us a message via the secure form below. We don’t display an email address to reduce spam.</p>
    <form id="contactForm" novalidate>
      <input type="text" name="_gotcha" autocomplete="off" style="display:none" tabindex="-1" />
      <label class="small">Your email</label>
      <input type="email" id="cfEmail" name="email" required placeholder="you@example.com" />
      <label class="small" style="margin-top:8px">Message</label>
      <textarea id="cfMsg" name="message" rows="5" required placeholder="How can we help?"></textarea>
      <div style="display:flex;gap:10px;align-items:center;margin-top:10px">
        <button type="submit" class="btn" id="cfSubmit">Send</button>
        <span class="hint" id="cfStatus" aria-live="polite"></span>
      </div>
    </form>
    <p class="hint" style="margin-top:10px">We never upload your images. Ads may set cookies per Google policies.</p>
    <div class="modal-actions"><button class="btn secondary" data-close type="button">Close</button></div>
  </div></dialog>

  <script>
    // ===== i18n (EN/AR) =====
    const i18n = {
      en: {
        title: "Free Image Converter",
        badge: "Free forever · No login",
        lead: "Free forever. No sign-up. No uploads. Convert between JPG, PNG, WebP, and ICO with drag-and-drop, batch processing, optional resize, and ZIP download. Ad-supported.",
        lblFormat: "Output format",
        fmtHint: "JPG/WebP allow quality setting. ICO is a 256×256 PNG inside an ICO header.",
        lblQuality: "Quality (JPG/WebP)",
        lblBG: "Background for JPG (transparent areas)",
        bgHint: "Used only when output is JPG.",
        lblResize: "Resize before convert (optional)",
        resizeHint: "Reduce size for faster processing on low-memory devices.",
        lblPercent: "Scale percentage",
        lblMaxW: "Max width (px)",
        choose: "Choose Files",
        clear: "Clear List",
        privacyNote: "Free · No login · All processing in your browser.",
        dropTitle: "Drag & drop images",
        dropHint: "JPG, PNG, WebP, ICO. Batch supported. *Large images work; device memory is the only limit.",
        convert: "Convert",
        zip: "Download All (ZIP)",
        notes: "Notes",
        preview: "Preview", file: "File", original: "Original", output: "Output",
        status: "Status", download: "Download", done: "Ready", processing: "Processing…",
        failed: "Failed", toast: "✅ Conversion complete",
        altThumb: "Thumbnail preview"
      },
      ar: {
        title: "محوّل صيغ الصور مجانًا",
        badge: "مجاني دائمًا · بدون تسجيل",
        lead: "مجاني للأبد. بدون تسجيل أو رفع. تحويل بين ‎JPG‎ و‎PNG‎ و‎WebP‎ و‎ICO مع السحب والإفلات، معالجة دُفعية، تغيير الحجم اختياري، وتنزيل ZIP. مدعوم بالإعلانات.",
        lblFormat: "صيغة الإخراج",
        fmtHint: "يمكن ضبط الجودة لملفي JPG وWebP. يتم إنشاء ICO من ‎PNG بحجم ‎256×256 داخل ملف ICO.",
        lblQuality: "الجودة (JPG/WebP)",
        lblBG: "لون الخلفية لملف JPG (للمناطق الشفافة)",
        bgHint: "يُستخدم فقط عند اختيار JPG.",
        lblResize: "تغيير الحجم قبل التحويل (اختياري)",
        resizeHint: "تقليل الحجم لتسريع المعالجة على الأجهزة محدودة الذاكرة.",
        lblPercent: "نسبة التصغير/التكبير",
        lblMaxW: "أقصى عرض (بكسل)",
        choose: "اختر الملفات",
        clear: "مسح القائمة",
        privacyNote: "مجاني · بدون تسجيل · كل المعالجة داخل متصفحك.",
        dropTitle: "اسحب وأفلت الصور هنا",
        dropHint: "JPG, PNG, WebP, ICO — يدعم الدُفعات. *تعمل مع الصور الكبيرة؛ الحد فقط هو ذاكرة جهازك.",
        convert: "تحويل",
        zip: "تنزيل الكل (ZIP)",
        notes: "ملاحظات",
        preview: "معاينة", file: "الملف", original: "الأصلي", output: "الإخراج",
        status: "الحالة", download: "تنزيل", done: "جاهز", processing: "جارٍ المعالجة…",
        failed: "فشل", toast: "✅ تم إكمال التحويل",
        altThumb: "صورة مُصغّرة"
      }
    };
    let lang = 'en';

    const $ = s => document.querySelector(s);
    const fileBody = $('#fileBody');
    const progressBar = $('#progressBar');
    const progressText = $('#progressText');
    const state = { files: [], zip: new JSZip(), convertedCount: 0 };
    let idCounter = 0;

    function applyLang(l){
      lang=l; const t=i18n[l];
      document.documentElement.lang=l;
      document.documentElement.dir=(l==='ar')?'rtl':'ltr';
      $('#appTitle').textContent=t.title; $('#freeBadge').textContent=t.badge;

      // Sync meta for description/OG description + title
      document.title = (l==='en')
        ? "Free Image Converter | JPG to PNG, WebP, ICO Online (No Sign-Up)"
        : "محوّل صيغ الصور مجانًا | JPG إلى PNG و WebP و ICO (بدون تسجيل)";
      document.querySelector('meta[name="description"]')?.setAttribute('content', t.lead);
      document.querySelector('meta[property="og:description"]')?.setAttribute('content', t.lead);
      document.querySelector('meta[name="twitter:description"]')?.setAttribute('content', t.lead);

      $('#lead').textContent=t.lead;
      $('#lblFormat').textContent=t.lblFormat; $('#fmtHint').textContent=t.fmtHint;
      $('#lblQuality').textContent=t.lblQuality; $('#lblBG').textContent=t.lblBG; $('#bgHint').textContent=t.bgHint;
      $('#lblResize').textContent=t.lblResize; $('#resizeHint').textContent=t.resizeHint;
      $('#lblPercent').textContent=t.lblPercent; $('#lblMaxW').textContent=t.lblMaxW;
      $('#pickBtn').textContent=t.choose; $('#clearBtn').textContent=t.clear; $('#privacyNote').textContent=t.privacyNote;
      $('#dropTitle').textContent=t.dropTitle; $('#dropHint').textContent=t.dropHint;
      $('#convertBtn').textContent=t.convert; $('#zipBtn').textContent=t.zip;
      $('#faqTitle').textContent=t.notes;
      document.querySelector('#fileTable thead').innerHTML=`
        <tr>
          <th scope="col">${t.preview}</th><th scope="col">${t.file}</th>
          <th class="nowrap" scope="col">${t.original}</th><th class="nowrap" scope="col">${t.output}</th>
          <th scope="col">${t.status}</th><th scope="col">${t.download}</th>
        </tr>`;
      $('#toast').textContent=t.toast;
      $('#btnEN').setAttribute('aria-pressed', l==='en'); $('#btnAR').setAttribute('aria-pressed', l==='ar');
    }

    function setTheme(mode){
      document.documentElement.removeAttribute('data-theme');
      if(mode==='light' || mode==='dark'){ document.documentElement.setAttribute('data-theme', mode); }
      $('#themeLight').setAttribute('aria-pressed', mode==='light');
      $('#themeDark').setAttribute('aria-pressed', mode==='dark');
      $('#themeAuto').setAttribute('aria-pressed', mode!=='light' && mode!=='dark');
      try{ localStorage.setItem('theme', mode); }catch{}
    }

    function makeRow(item){
      const tr=document.createElement('tr');
      tr.id=`row-${item.id}`;
      const alt = (i18n[lang]?.altThumb || "Thumbnail") + ": " + (item.file?.name || "image");
      tr.innerHTML=`
        <td><img class="thumb" src="${item.thumbUrl}" alt="${alt}"></td>
        <td class="nowrap">${item.file.name}</td>
        <td>${Math.round(item.imgW)}×${Math.round(item.imgH)}</td>
        <td id="out-${item.id}">—</td>
        <td id="st-${item.id}">—</td>
        <td id="dl-${item.id}">—</td>`;
      return tr;
    }

    function humanSize(b){const u=["B","KB","MB","GB"];let i=0,n=b;while(n>=1024&&i<u.length-1){n/=1024;i++}return `${n.toFixed(n<10&&i>0?2:0)} ${u[i]}`}

    function toast(){const el=$('#toast');el.classList.add('show');setTimeout(()=>el.classList.remove('show'),2600)}
    function updateRowStatus(id,txt){const el=$(`#st-${id}`); if(el) el.textContent=txt}
    function setOutInfo(id,txt){const el=$(`#out-${id}`); if(el) el.textContent=txt}
    function setDownloadBtn(id,name,blob){
      const td=$(`#dl-${id}`); if(!td) return;
      td.innerHTML='';
      const b=document.createElement('button');
      b.className='btn secondary';
      b.textContent=i18n[lang].download || 'Download';
      b.setAttribute('aria-label', 'Download ' + name);
      b.addEventListener('click',()=>saveAs(blob,name));
      td.appendChild(b)
    }

    async function analyzeFile(file){
      const url=URL.createObjectURL(file);
      try{
        // Respect EXIF orientation
        const bmp=await createImageBitmap(file, { imageOrientation: 'from-image' }).catch(()=>null);
        if(bmp){
          const width=bmp.width,height=bmp.height;
          let tCanvas,ctx;
          if(typeof OffscreenCanvas!=='undefined'){tCanvas=new OffscreenCanvas(52,52); ctx=tCanvas.getContext('2d')}
          else{tCanvas=document.createElement('canvas'); tCanvas.width=52; tCanvas.height=52; ctx=tCanvas.getContext('2d')}
          const scale=Math.min(52/width,52/height), w=Math.max(1,Math.round(width*scale)), h=Math.max(1,Math.round(height*scale));
          ctx.clearRect(0,0,52,52);
          ctx.imageSmoothingEnabled = true;
          ctx.imageSmoothingQuality = 'high';
          ctx.drawImage(bmp,(52-w)/2,(52-h)/2,w,h);
          const blob=tCanvas.convertToBlob? await tCanvas.convertToBlob() : await new Promise(r=>tCanvas.toBlob(r,'image/png'));
          const thumbUrl=URL.createObjectURL(blob);
          bmp.close?.();
          return { url, imgW: width, imgH: height, thumbUrl };
        }else{
          const img=await new Promise((res,rej)=>{const im=new Image(); im.onload=()=>res(im); im.onerror=rej; im.src=url;});
          const c=document.createElement('canvas'); c.width=52; c.height=52; const ctx=c.getContext('2d');
          const scale=Math.min(52/img.width,52/img.height), w=Math.max(1,Math.round(img.width*scale)), h=Math.max(1,Math.round(img.height*scale));
          ctx.imageSmoothingEnabled = true;
          ctx.imageSmoothingQuality = 'high';
          ctx.drawImage(img,(52-w)/2,(52-h)/2,w,h);
          const blob=await new Promise(r=>c.toBlob(r,'image/png'));
          const thumbUrl=URL.createObjectURL(blob);
          return { url, imgW: img.width, imgH: img.height, thumbUrl };
        }
      }catch(e){ URL.revokeObjectURL(url); throw e; }
    }

    function extFor(fmt){ return fmt==='jpg'?'jpg':fmt==='ico'?'ico':fmt; }
    function mimeFor(fmt){ return fmt==='jpg'?'image/jpeg':fmt==='png'?'image/png':fmt==='webp'?'image/webp':'image/png'; }

    async function wrapPngAsIco(pngBlob){
      const png=new Uint8Array(await pngBlob.arrayBuffer());
      const headerSize=22; const out=new Uint8Array(headerSize+png.length); const dv=new DataView(out.buffer);
      dv.setUint16(0,0,true); dv.setUint16(2,1,true); dv.setUint16(4,1,true);
      out[6]=0; out[7]=0; out[8]=0; out[9]=0;
      dv.setUint16(10,1,true); dv.setUint16(12,32,true);
      dv.setUint32(14,png.length,true); dv.setUint32(18,headerSize,true);
      out.set(png, headerSize);
      return new Blob([out], { type:'image/x-icon' });
    }

    function applyResizeDims(srcW, srcH){
      const mode=$('#resizeMode').value;
      if(mode==='percent'){
        const p=Math.max(10, Math.min(200, parseInt($('#percentVal').value||'100',10)));
        return { w: Math.max(1, Math.round(srcW*p/100)), h: Math.max(1, Math.round(srcH*p/100)) };
      }
      if(mode==='maxw'){
        const maxW=Math.max(64, parseInt($('#maxWidth').value||'1000',10));
        if(srcW<=maxW) return { w: srcW, h: srcH };
        const scale=maxW/srcW;
        return { w: Math.round(srcW*scale), h: Math.round(srcH*scale) };
      }
      return { w: srcW, h: srcH };
    }

    function uniqueName(base, ext, used){
      let name = `${base}.${ext}`, i=1;
      while(used.has(name)){ name = `${base} (${i++}).${ext}`; }
      used.add(name); return name;
    }

    function acceptFiles(files){
      const okTypes = /^(image\/(png|jpeg|webp|avif|gif|bmp|x-icon|vnd\.microsoft\.icon))$/i;
      return Array.from(files).filter(f => okTypes.test(f.type) || /\.ico$/i.test(f.name));
    }

    async function addFiles(files){
      const accepted = acceptFiles(files);
      for(const file of accepted){
        const info=await analyzeFile(file).catch(()=>null);
        if(!info) continue;
        const item={ id:++idCounter, file, url:info.url, thumbUrl:info.thumbUrl, imgW:info.imgW, imgH:info.imgH, status:'pending', outBlob:null, outName:null };
        state.files.push(item);
        fileBody.appendChild(makeRow(item));
        updateRowStatus(item.id,'—');
      }
      $('#zipBtn').disabled=true;
      $('#zipBtn').setAttribute('aria-disabled','true');
      updateProgress(0, state.files.length);
    }

    function clearList(){
      state.files.forEach(f=>{ URL.revokeObjectURL(f.url); URL.revokeObjectURL(f.thumbUrl); });
      state.files=[]; state.zip=new JSZip(); state.convertedCount=0; fileBody.innerHTML=''; $('#zipBtn').disabled=true;
      $('#zipBtn').setAttribute('aria-disabled','true');
      updateProgress(0,0);
    }

    function updateProgress(done, total){
      const pct = total? Math.round((done/total)*100) : 0;
      progressBar.style.width = pct + '%';
      progressText.textContent = pct + '%';
      const bar = document.querySelector('.progress');
      if (bar){
        bar.setAttribute('role','progressbar');
        bar.setAttribute('aria-valuemin','0'); bar.setAttribute('aria-valuemax','100');
        bar.setAttribute('aria-valuenow', String(pct));
      }
    }

    async function convertOne(item, fmt, quality, bgColor){
      const bmp=await createImageBitmap(item.file, { imageOrientation: 'from-image' }).catch(()=>null);
      const sourceW=bmp?bmp.width:item.imgW, sourceH=bmp?bmp.height:item.imgH;
      const dims=applyResizeDims(sourceW, sourceH);
      const targetW = (fmt==='ico') ? 256 : dims.w;
      const targetH = (fmt==='ico') ? 256 : dims.h;

      let canvas=document.createElement('canvas'), ctx=canvas.getContext('2d');
      canvas.width=targetW; canvas.height=targetH;

      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = 'high';

      if(fmt==='ico'){
        ctx.clearRect(0,0,256,256);
        const scale=Math.min(256/sourceW,256/sourceH);
        const w=Math.max(1,Math.round(sourceW*scale)), h=Math.max(1,Math.round(sourceH*scale));
        const dx=(256-w)/2, dy=(256-h)/2;
        if(bmp) ctx.drawImage(bmp,dx,dy,w,h);
        else{const img=new Image(); img.src=item.url; await img.decode(); ctx.drawImage(img,dx,dy,w,h);}
        const pngBlob=await window.toBlobSafe(canvas,'image/png',1);
        const icoBlob=await wrapPngAsIco(pngBlob);
        bmp?.close?.();
        return { blob: icoBlob, outW:256, outH:256 };
      }

      if(fmt==='jpg'){ ctx.fillStyle=bgColor||'#ffffff'; ctx.fillRect(0,0,canvas.width,canvas.height); }
      else{ ctx.clearRect(0,0,canvas.width,canvas.height); }

      if(bmp) ctx.drawImage(bmp,0,0,sourceW,sourceH,0,0,targetW,targetH);
      else{ const img=new Image(); img.src=item.url; await img.decode(); ctx.drawImage(img,0,0,sourceW,sourceH,0,0,targetW,targetH); }
      bmp?.close?.();

      const mime=mimeFor(fmt); const q=(fmt==='jpg'||fmt==='webp')?quality:undefined;
      const blob = await window.toBlobSafe(canvas, mime, q);
      return { blob, outW: targetW, outH: targetH };
    }

    async function runConversion(){
      if(!state.files.length) return;
      const t = i18n[lang];
      const fmt=$('#fmtSelect').value, quality=parseFloat($('#quality').value), bg=$('#bgColor').value;
      state.zip=new JSZip(); state.convertedCount=0;

      const usedNames = new Set();
      for(const item of state.files) updateRowStatus(item.id, t.processing || 'Processing…');

      let done=0, total=state.files.length; updateProgress(0,total);
      for(const item of state.files){
        try{
          const base = item.file.name.replace(/\.[^.]+$/,'') || 'image';
          const outName = uniqueName(base, extFor(fmt), usedNames);
          const { blob, outW, outH } = await convertOne(item, fmt, quality, bg);
          item.outBlob=blob; item.outName=outName;
          setOutInfo(item.id, `${outW}×${outH} (${humanSize(blob.size)})`);
          setDownloadBtn(item.id, outName, blob);
          updateRowStatus(item.id, t.done || 'Ready');
          state.zip.file(outName, blob);
          state.convertedCount++;
        }catch(e){ console.error(e); updateRowStatus(item.id, t.failed || 'Failed'); }
        done++; updateProgress(done,total);
      }
      const zipBtn = $('#zipBtn');
      zipBtn.disabled = state.convertedCount===0;
      zipBtn.setAttribute('aria-disabled', state.convertedCount===0 ? 'true' : 'false');
      if (state.convertedCount>0) toast();
    }

    async function downloadZip(){
      if(!state.convertedCount) return;
      const blob=await state.zip.generateAsync({ type:'blob', streamFiles:true });
      saveAs(blob, 'converted_images.zip');
    }

    // ---------- CONTACT FORM (Formspree only) ----------
    const FS_ENDPOINT = "https://formspree.io/f/mzzvqonw";

    (function wireContactForm(){
      const form = document.getElementById('contactForm');
      if (!form) return;

      const emailEl = document.getElementById('cfEmail');
      const msgEl = document.getElementById('cfMsg');
      const statusEl = document.getElementById('cfStatus');
      const btn = document.getElementById('cfSubmit');

      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        statusEl.textContent = '';

        if (!FS_ENDPOINT) { statusEl.textContent = 'Contact temporarily unavailable. Please try again later.'; return; }
        if (!emailEl.checkValidity()) { statusEl.textContent = 'Please enter a valid email.'; return; }
        if (!msgEl.value.trim()) { statusEl.textContent = 'Please write a message.'; return; }

        btn.disabled = true; btn.textContent = 'Sending…';
        try {
          const data = new FormData(form);
          data.append('_subject', 'Contact from Free Image Converter');
          data.append('_replyto', emailEl.value);

          const res = await fetch(FS_ENDPOINT, { method: 'POST', body: data, headers: { 'Accept': 'application/json' } });

          if (res.ok) {
            statusEl.textContent = 'Message sent!';
            try { const t = document.getElementById('toast'); const old=t.textContent; t.textContent='✅ Message sent'; t.classList.add('show'); setTimeout(()=>{ t.textContent=old; t.classList.remove('show'); }, 2000);} catch {}
            form.reset();
          } else {
            const j = await res.json().catch(()=> ({}));
            statusEl.textContent = j?.error || 'Failed to send. Please try again.';
          }
        } catch (err) {
          console.error(err);
          statusEl.textContent = 'Network error. Please try again.';
        } finally {
          btn.disabled = false; btn.textContent = 'Send';
        }
      });
    })();

    // Wiring
    $('#pickBtn').addEventListener('click',()=>$('#picker').click());
    $('#picker').addEventListener('change',e=>addFiles(e.target.files));
    $('#clearBtn').addEventListener('click',clearList);
    $('#convertBtn').addEventListener('click',runConversion);
    $('#zipBtn').addEventListener('click',downloadZip);
    $('#quality').addEventListener('input',e=>$('#qualityVal').textContent=(+e.target.value).toFixed(2));

    const drop=$('#drop');
    ['dragenter','dragover'].forEach(evt=>drop.addEventListener(evt,e=>{e.preventDefault();e.stopPropagation();drop.classList.add('dragover')}))
    ;['dragleave','drop'].forEach(evt=>drop.addEventListener(evt,e=>{e.preventDefault();e.stopPropagation();drop.classList.remove('dragover')}))
    drop.addEventListener('drop',e=>{const dt=e.dataTransfer; if(dt?.files?.length) addFiles(dt.files)});

    // Prevent default open on page for out-of-zone drops
    ['dragover','drop'].forEach(evt=>{
      window.addEventListener(evt, e=>{ e.preventDefault(); });
    });

    function toggleControls(){
      const fmt=$('#fmtSelect').value;
      $('#qualityWrap').style.display=(fmt==='jpg'||fmt==='webp')?'':'none';
      $('#bgWrap').style.display=(fmt==='jpg')?'':'none';
    }
    $('#fmtSelect').addEventListener('change', toggleControls); toggleControls();

    function toggleResizeUI(){
      const mode=$('#resizeMode').value;
      $('#percentWrap').style.display = (mode==='percent')?'':'none';
      $('#maxwWrap').style.display = (mode==='maxw')?'':'none';
    }
    $('#resizeMode').addEventListener('change', toggleResizeUI); toggleResizeUI();

    // Language & Theme
    $('#btnEN').addEventListener('click',()=>applyLang('en'));
    $('#btnAR').addEventListener('click',()=>applyLang('ar'));
    applyLang('en');

    const savedTheme = (()=>{ try{ return localStorage.getItem('theme') || 'auto'; }catch{ return 'auto'; } })();
    setTheme(savedTheme);
    $('#themeLight').addEventListener('click',()=>setTheme('light'));
    $('#themeDark').addEventListener('click',()=>setTheme('dark'));
    $('#themeAuto').addEventListener('click',()=>setTheme('auto'));

    // Footer year
    $('#year').textContent=new Date().getFullYear();

    // Modals
    document.querySelectorAll('a[data-modal]').forEach(a=>{
      a.addEventListener('click', e=>{
        e.preventDefault();
        const id=a.getAttribute('data-modal'); const dlg=document.getElementById(id);
        dlg?.showModal();
      });
    });
    document.querySelectorAll('dialog [data-close]').forEach(b=>{
      b.addEventListener('click', e=> e.target.closest('dialog')?.close());
    });
  </script>

  <!-- GA Events wiring -->
  <script>
    document.addEventListener("DOMContentLoaded", function(){
      var cBtn = document.getElementById("convertBtn");
      var zBtn = document.getElementById("zipBtn");
      var cForm = document.getElementById("contactForm");

      if (cBtn) cBtn.addEventListener("click", function(){
        window.gtag && gtag("event", "convert_click", {event_category:"engagement", value:1});
      });

      if (zBtn) zBtn.addEventListener("click", function(){
        window.gtag && gtag("event", "zip_download", {event_category:"engagement", value:1});
      });

      if (cForm) cForm.addEventListener("submit", function(){
        window.gtag && gtag("event", "contact_submit", {event_category:"lead", value:1});
      });
    });
  </script>

  <!-- === Enhancements (toBlobSafe) === -->
  <script>
  (function(){
    if (window.__toBlobSafeInstalled) return; window.__toBlobSafeInstalled = true;
    window.toBlobSafe = function(canvas, mime, q){
      return new Promise(function(resolve){
        try {
          canvas.toBlob(function(b){
            if(!b && mime === 'image/webp'){
              canvas.toBlob(function(b2){ resolve(b2); }, 'image/png', 1);
            } else {
              resolve(b);
            }
          }, mime, q);
        } catch(e){
          canvas.toBlob(function(b2){ resolve(b2); }, 'image/png', 1);
        }
      });
    };
  })();
  </script>
  <!-- === End Enhancements === -->
</body>
</html>
